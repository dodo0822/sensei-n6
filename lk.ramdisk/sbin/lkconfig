#!/system/bin/sh

detectsu=`ls /data/data`
[ -z "$detectsu" ] && echo "Must be superuser!" && exit

while true; do

echo
echo "leanKernel configurator"
echo "---"
echo "0) display current settings"
echo "1) set screen_off_maxfreq"
echo "2) set mmc crc"
echo "3) set cpu boost"
echo
echo -n "please enter a number (or press enter to exit): "

read option

case $option in
0)
	echo
	echo "current settings"
	echo "----------------"
	echo -n "1) screen off maxfreq: "
	cat /sys/devices/system/cpu/cpufreq/interactive/screen_off_maxfreq
	echo -n "2) mmc crc: "
	cat /sys/module/mmc_core/parameters/use_spi_crc
	echo -n "3) cpu boost: "
	cat /sys/module/cpu_boost/parameters/cpuboost_enable
	echo
	;;
1)
	echo -n "Enter a number between 0 and 4 (0:650mhz,1:883mhz,2:1.2ghz/default,3:1.5ghz,4:disable): "
	read value
	case $value in
	  0) FREQ=652800;;
	  1) FREQ=883200;;
	  2) FREQ=1267200;;
	  3) FREQ=1574400;;
	  4) FREQ=2265600;;
	esac
	echo $FREQ > /data/data/leankernel/screen_off_maxfreq
	echo $FREQ > `ls -d /sys/devices/system/cpu/cpufreq/*a*`/screen_off_maxfreq
	echo "Done! (also will persist at boot)"
	;;
2)
	echo -n "Enter Y to enable, N to disable mmc crc: "
	read value
	echo $value > /data/data/leankernel/use_spi_crc
	echo $value > /sys/module/mmc_core/parameters/use_spi_crc
	echo "Done! (also will persist at boot)"
	;;
3)
        echo -n "Enter Y to enable, N to disable cpu boost: "
        read value
        echo $value > /data/data/leankernel/cpuboost_enable
        echo $value > /sys/module/cpu_boost/parameters/cpuboost_enable
        echo "Done! (also will persist at boot)"
	;;
*)
	exit
	;;
esac
echo
done
